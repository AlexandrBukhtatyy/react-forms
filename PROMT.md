# Задача: Реактивное поведение форм с подпиской на изменения

## Контекст

Проект использует архитектуру на основе **@preact/signals-react** для управления состоянием форм.

### Ключевые файлы архитектуры:
- `src/lib/forms/core/nodes/field-node.ts` - узел отдельного поля с реактивным состоянием
- `src/lib/forms/core/nodes/group-node.ts` - узел группы полей (форма/подформа)
- `src/lib/forms/core/nodes/array-node.ts` - узел для массивов форм
- `src/lib/forms/types/group-node-proxy.ts` - типизация с Proxy для прямого доступа к полям

### Текущая реализация:
- ✅ Поля формы хранят состояние в Signal (`value`, `errors`, `touched`, `dirty`, `status`)
- ✅ Computed signals для производных значений (`valid`, `invalid`, `shouldShowError`)
- ✅ Validation Schema API с контекстной валидацией
- ✅ Рекурсивная типизация для вложенных форм и массивов
- ✅ Метод `updateComponentProps()` для динамического обновления пропсов

### Текущие возможности подписки:
```typescript
// Реактивность через computed signals
const isValid = computed(() => form.email.valid.value && form.password.valid.value);

// Использование в React компонентах (автоматическая подписка)
<div>{form.email.value.value}</div>
<div>{form.email.errors.value.map(err => err.message)}</div>
```

## Задача

Проанализируй реализованный подход и **предложи варианты** для описания сложного поведения формы с подпиской на изменения полей.

### Требуемые сценарии:

1. **Cross-field зависимости**
   - Поле B должно обновляться при изменении поля A
   - Пример: при изменении `sameAsRegistration` копировать значения из `registrationAddress` в `residenceAddress`

2. **Условное отображение/скрытие полей**
   - Показывать `propertyValue` только если `loanType === 'mortgage'`
   - Динамически enable/disable полей в зависимости от других полей

3. **Автозаполнение и каскадные изменения**
   - При выборе города автоматически заполнять регион
   - При изменении суммы кредита пересчитывать ежемесячный платеж

4. **Валидация с зависимостями**
   - `initialPayment` не должен превышать `propertyValue`
   - `workExperienceCurrent` не должен превышать `workExperienceTotal`

5. **Динамическое обновление справочников**
   - При изменении страны обновлять список городов в Select
   - При изменении категории обновлять список подкатегорий

### Ожидаемый результат:

Предложи **несколько вариантов** (минимум 2-3) API/паттернов для реализации таких сценариев:

1. **Вариант 1**: Декларативный подход (например, через конфигурацию)
2. **Вариант 2**: Императивный подход (например, через хуки/эффекты)
3. **Вариант 3**: Гибридный подход

Для каждого варианта опиши:
- ✅ Как будет выглядеть API использования (код примеров)
- ✅ Где будет размещаться логика (в FieldNode, GroupNode, или отдельно)
- ✅ Как будет работать подписка на изменения (effect, computed, watch и т.д.)
- ✅ Преимущества и недостатки подхода
- ✅ Совместимость с текущей архитектурой

### Важные ограничения:

- ❌ НЕ ломать существующий API форм
- ✅ Использовать Signals для реактивности (не добавлять сторонние библиотеки)
- ✅ Сохранять типобезопасность TypeScript
- ✅ Поддерживать вложенные формы и массивы
- ✅ Минимизировать ре-рендеры React компонентов

### Дополнительно:

Если возможно, предложи также:
- Как интегрировать с существующим Validation Schema API
- Как избежать циклических зависимостей
- Как тестировать такое поведение
- Примеры использования для реального кейса из `CreditApplicationForm`

## Ссылки на примеры

Реальный пример формы: `src/domains/credit-applications/form/`
- Модель: `models/create-credit-application-form.ts`
- Валидация: `validation/credit-application-validation.ts`
- Компоненты: `components/CreditApplicationForm.tsx`