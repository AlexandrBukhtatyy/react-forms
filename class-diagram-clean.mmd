classDiagram
    %% ============================================================================
    %% ABSTRACT BASE CLASS
    %% ============================================================================
    class FormNode {
        <<abstract>>
        +ReadonlySignal~T~ value
        +ReadonlySignal~boolean~ valid
        +ReadonlySignal~boolean~ invalid
        +ReadonlySignal~boolean~ touched
        +ReadonlySignal~boolean~ dirty
        +ReadonlySignal~boolean~ pending
        +ReadonlySignal~ValidationError[]~ errors
        +ReadonlySignal~FieldStatus~ status
        +getValue()* T
        +setValue(value, options?)* void
        +patchValue(value)* void
        +reset(value?)* void
        +validate()* Promise~boolean~
        +setErrors(errors)* void
        +clearErrors()* void
        +markAsTouched()* void
        +markAsUntouched()* void
        +markAsDirty()* void
        +markAsPristine()* void
        +touchAll() void
        +disable?() void
        +enable?() void
        +dispose?() void
    }

    %% ============================================================================
    %% FIELD NODE
    %% ============================================================================
    class FieldNode {
        -Signal~T~ _value
        -Signal~ValidationError[]~ _errors
        -Signal~boolean~ _touched
        -Signal~boolean~ _dirty
        -Signal~FieldStatus~ _status
        -Signal~boolean~ _pending
        -Signal~Record~ _componentProps
        -ValidatorFn[] validators
        -AsyncValidatorFn[] asyncValidators
        -string updateOn
        -T initialValue
        -number currentValidationId
        -number debounceMs
        -Timer validateDebounceTimer
        -Function validateDebounceResolve
        -Function[] disposers
        +FieldConfig component
        +ReadonlySignal~Record~ componentProps
        +ReadonlySignal~boolean~ shouldShowError
        +constructor(config)
        +getValue() T
        +setValue(value, options?) void
        +patchValue(value) void
        +reset(value?) void
        +resetToInitial() void
        +validate(options?) Promise~boolean~
        -validateImmediate() Promise~boolean~
        +setErrors(errors) void
        +clearErrors() void
        +markAsTouched() void
        +markAsUntouched() void
        +markAsDirty() void
        +markAsPristine() void
        +disable() void
        +enable() void
        +updateComponentProps(props) void
        +setUpdateOn(updateOn) void
        +watch(callback) Function
        +computeFrom(sources, computeFn) Function
        +dispose() void
    }

    %% ============================================================================
    %% GROUP NODE
    %% ============================================================================
    class GroupNode {
        -Map~K,FormNode~ fields
        -Signal~boolean~ _submitting
        -Signal~boolean~ _disabled
        -Signal~ValidationError[]~ _formErrors
        -T _cachedValue
        -Map _cachedFieldValues
        -Function[] disposers
        -GroupNodeWithControls _proxyInstance
        +ReadonlySignal~boolean~ submitting
        +constructor(schema)
        +constructor(config)
        +getValue() T
        +setValue(value, options?) void
        +patchValue(value) void
        +reset(value?) void
        +resetToInitial() void
        +validate() Promise~boolean~
        +setErrors(errors) void
        +clearErrors() void
        +markAsTouched() void
        +markAsUntouched() void
        +markAsDirty() void
        +markAsPristine() void
        +submit(onSubmit) Promise
        +applyValidationSchema(schemaFn) void
        +applyBehaviorSchema(schemaFn) Function
        +getFieldByPath(path) FormNode
        -parsePathWithArrays(path) string[]
        +applyContextualValidators(validators) Promise~void~
        -createNode(config) FormNode
        -extractValuesFromSchema(schema) any
        -isFieldConfig(config) boolean
        -isGroupConfig(config) boolean
        +linkFields(sourceKey, targetKey, transform?) Function
        +watchField(fieldPath, callback) Function
        +disable() void
        +enable() void
        +dispose() void
    }

    %% ============================================================================
    %% ARRAY NODE
    %% ============================================================================
    class ArrayNode {
        -Signal~FormNode[]~ items
        -FormSchema itemSchema
        -PartialT[] initialItems
        -Function[] disposers
        -any validationSchemaFn
        -any behaviorSchemaFn
        +ReadonlySignal~number~ length
        +constructor(schema, initialItems?)
        +push(initialValue?) void
        +removeAt(index) void
        +insert(index, initialValue?) void
        +clear() void
        +at(index) GroupNodeWithControls
        +getValue() T[]
        +setValue(values, options?) void
        +patchValue(values) void
        +reset(values?) void
        +resetToInitial() void
        +validate() Promise~boolean~
        +setErrors(errors) void
        +clearErrors() void
        +markAsTouched() void
        +markAsUntouched() void
        +markAsDirty() void
        +markAsPristine() void
        +forEach(callback) void
        +map(callback) Array
        -createItem(initialValue?) FormNode
        -isGroupSchema(schema) boolean
        +applyValidationSchema(schemaFn) void
        +applyBehaviorSchema(schemaFn) void
        +watchItems(fieldKey, callback) Function
        +watchLength(callback) Function
        +dispose() void
        +disable() void
        +enable() void
    }

    %% ============================================================================
    %% VALIDATION CONTEXT
    %% ============================================================================
    class ValidationContextImpl {
        -GroupNode form
        -K fieldKey
        -FieldNode control
        +constructor(form, fieldKey, control)
        +value() TField
        +getField(path) any
        -resolveNestedPath(path) any
        +setField(path, value) void
        -setNestedPath(path, value) void
        +formValue() TForm
        +getControl() FieldNode
        +getForm() GroupNode
    }

    %% ============================================================================
    %% TREE VALIDATION CONTEXT
    %% ============================================================================
    class TreeValidationContextImpl {
        -GroupNode form
        +constructor(form)
        +getField(path) any
        -resolveNestedPath(path) any
        +formValue() TForm
        +getForm() GroupNode
    }

    %% ============================================================================
    %% BEHAVIOR CONTEXT
    %% ============================================================================
    class BehaviorContextImpl {
        -GroupNode form
        +GroupNodeWithControls formNode
        +constructor(form)
        +getField(path) any
        +setField(path, value) void
        +updateComponentProps(field, props) void
        +validateField(field) Promise~boolean~
        +setErrors(field, errors) void
        +clearErrors(field) void
        +getForm() TForm
        +getFieldNode(path) FormNode
        -resolveFieldNode(pathOrNode) FormNode
    }

    %% ============================================================================
    %% VALIDATION REGISTRY
    %% ============================================================================
    class ValidationRegistryClass {
        -RegistrationContext[] contextStack
        -WeakMap formStoreMap
        +beginRegistration() RegistrationContext
        +endRegistration(form) void
        +cancelRegistration() void
        +getCurrentContext() RegistrationContext
        +registerSync(fieldPath, validator, options?) void
        +registerAsync(fieldPath, validator, options?) void
        +registerTree(validator, options?) void
        +enterCondition(fieldPath, conditionFn) void
        +exitCondition() void
        +registerArrayItemValidation(fieldPath, itemSchemaFn) void
        +getValidators(form) ValidatorRegistration[]
        -applyValidators(form, validators) void
        -applyArrayItemValidators(form, validators) void
    }

    %% ============================================================================
    %% REGISTRATION CONTEXT
    %% ============================================================================
    class RegistrationContext {
        -ValidatorRegistration[] validators
        -ConditionStack[] conditionStack
        +addValidator(registration) void
        +enterCondition(fieldPath, conditionFn) void
        +exitCondition() void
        +getValidators() ValidatorRegistration[]
    }

    %% ============================================================================
    %% BEHAVIOR REGISTRY
    %% ============================================================================
    class BehaviorRegistryClass {
        -BehaviorRegistration[] registrations
        -boolean isRegistering
        +beginRegistration() void
        +register(registration) void
        +endRegistration(form) Object
        -createEffect(registration, form, context) Function
        -createCopyEffect(registration, form, context, withDebounce) Function
        -createEnableEffect(registration, form, context, withDebounce) Function
        -createShowEffect(registration, form, context, withDebounce) Function
        -createComputeEffect(registration, form, context, withDebounce) Function
        -createWatchEffect(registration, form, context, withDebounce) Function
        -createRevalidateEffect(registration, form, context, withDebounce) Function
        -createSyncEffect(registration, form, context, withDebounce) Function
        -resolveNode(form, fieldPath) FormNode
    }

    %% ============================================================================
    %% INTERFACES - RESOURCES
    %% ============================================================================
    class ResourceItem {
        <<interface>>
        +string|number id
        +string label
        +T value
    }

    class ResourceResult {
        <<interface>>
        +ResourceItem[] items
        +number totalCount
    }

    class ResourceConfig {
        <<interface>>
        +string type
        +Function load
    }

    class ResourceLoadParams {
        <<interface>>
        +string search
        +number page
        +number pageSize
    }

    %% ============================================================================
    %% INTERFACES - BEHAVIOR TYPES
    %% ============================================================================
    class BehaviorContext {
        <<interface>>
        +GroupNodeWithControls formNode
        +getField(path) any
        +setField(path, value) void
        +updateComponentProps(field, props) void
        +validateField(field) Promise~boolean~
        +setErrors(field, errors) void
        +clearErrors(field) void
        +getForm() TForm
        +getFieldNode(path) FormNode
    }

    class BehaviorRegistration {
        <<interface>>
        +BehaviorType type
        +FieldPathNode sourceField
        +FieldPathNode[] sourceFields
        +FieldPathNode targetField
        +Function condition
        +Function callback
        +Function computeFn
        +Function transform
        +string[]|all fields
        +number debounce
        +boolean immediate
        +boolean resetOnDisable
        +string trigger
        +Record options
    }

    class CopyFromOptions {
        <<interface>>
        +Function when
        +K[]|all fields
        +Function transform
        +number debounce
    }

    class EnableWhenOptions {
        <<interface>>
        +boolean resetOnDisable
        +number debounce
    }

    class ComputeFromOptions {
        <<interface>>
        +string trigger
        +number debounce
        +Function condition
    }

    class WatchFieldOptions {
        <<interface>>
        +number debounce
        +boolean immediate
    }

    class RevalidateWhenOptions {
        <<interface>>
        +number debounce
    }

    class SyncFieldsOptions {
        <<interface>>
        +Function transform
        +number debounce
    }

    %% ============================================================================
    %% INTERFACES - VALIDATION TYPES
    %% ============================================================================
    class ValidationContext {
        <<interface>>
        +value() TField
        +getField(path) any
        +setField(path, value) void
        +formValue() TForm
        +getControl() FieldNode
        +getForm() GroupNode
    }

    class TreeValidationContext {
        <<interface>>
        +getField(path) any
        +formValue() TForm
        +getForm() GroupNode
    }

    class ValidatorRegistration {
        <<interface>>
        +string fieldPath
        +string type
        +Function validator
        +Object condition
        +Object options
    }

    class ValidateOptions {
        <<interface>>
        +string message
        +Record params
    }

    class ValidateAsyncOptions {
        <<interface>>
        +string message
        +Record params
        +number debounce
    }

    class ValidateTreeOptions {
        <<interface>>
        +string targetField
    }

    %% ============================================================================
    %% RELATIONSHIPS - INHERITANCE
    %% ============================================================================
    FormNode <|-- FieldNode
    FormNode <|-- GroupNode
    FormNode <|-- ArrayNode
    ValidationContext <|.. ValidationContextImpl
    TreeValidationContext <|.. TreeValidationContextImpl
    BehaviorContext <|.. BehaviorContextImpl

    %% ============================================================================
    %% RELATIONSHIPS - COMPOSITION
    %% ============================================================================
    GroupNode *-- "0..*" FormNode : fields
    ArrayNode *-- "0..*" FormNode : items
    ValidationRegistryClass *-- "0..*" RegistrationContext : contextStack
    RegistrationContext *-- "0..*" ValidatorRegistration : validators
    BehaviorRegistryClass *-- "0..*" BehaviorRegistration : registrations

    %% ============================================================================
    %% RELATIONSHIPS - ASSOCIATIONS
    %% ============================================================================
    GroupNode ..> ValidationContextImpl : creates
    GroupNode ..> TreeValidationContextImpl : creates
    GroupNode ..> BehaviorContextImpl : creates
    ValidationContextImpl --> GroupNode : form
    ValidationContextImpl --> FieldNode : control
    TreeValidationContextImpl --> GroupNode : form
    BehaviorContextImpl --> GroupNode : form
    ValidationRegistryClass --> GroupNode : manages
    BehaviorRegistryClass --> GroupNode : manages
    ValidationRegistryClass ..> ValidationContextImpl : uses
    ValidationRegistryClass ..> TreeValidationContextImpl : uses
    BehaviorRegistryClass ..> BehaviorContextImpl : uses
    ResourceConfig --> ResourceResult : returns
    ResourceConfig --> ResourceLoadParams : accepts
    ResourceResult --> ResourceItem : contains